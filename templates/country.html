{% extends "base.html" %}

{% block title %}{{ country }} eSIM Plans - eSim Scanner AI{% endblock %}

{% block content %}
<!-- Country Hero Section -->
<section class="relative bg-cover bg-center bg-no-repeat py-20 md:py-28"
    style="background-image: url('{% if image_url %}{{ image_url }}{% else %}https://loremflickr.com/1600/900/{{ country_slug }},travel/all{% endif %}');">
    <!-- Dark Overlay -->
    <div class="absolute inset-0 bg-black bg-opacity-60"></div>

    <!-- Content -->
    <div class="relative z-10 container mx-auto px-4 text-center">
        <div class="flex items-center justify-center mb-6">
            <a href="index.html" class="text-white hover:text-blue-300 mr-2 transition-colors">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                </svg>
            </a>
            <span class="text-gray-200">Home</span>
            <span class="mx-2 text-gray-400">/</span>
            <span class="text-white font-medium">{{ country }}</span>
        </div>
        <h1 class="text-4xl md:text-5xl lg:text-6xl font-bold text-white mb-4 drop-shadow-lg">
            Best eSIM Plans for {{ country }}
        </h1>
        {% if country_code %}
        <div class="flex items-center justify-center gap-2 mb-4">
            <img src="https://flagcdn.com/w40/{{ country_code|lower }}.png" alt="{{ country }} flag"
                class="w-10 h-7 object-cover rounded shadow-md" onerror="this.style.display='none'">
        </div>
        {% endif %}
        <p class="text-xl md:text-2xl text-gray-100 max-w-2xl mx-auto drop-shadow-md">
            {% if intro_text %}{{ intro_text }}{% else %}Compare prices and data plans from top providers{% endif %}
        </p>
    </div>
</section>

<!-- Sticky Filter Bar -->
<nav class="sticky top-0 z-40 bg-white shadow-lg border-b-2 border-gray-300">
    <div class="container mx-auto px-4">
        <div class="flex items-center justify-center gap-2 py-3 overflow-x-auto scrollbar-hide">
            <!-- All Plans Button -->
            <button onclick="filterPlans('all')"
                class="filter-btn active px-4 py-2 text-sm font-semibold text-white bg-blue-600 rounded-full transition-all duration-200 whitespace-nowrap">
                All Plans
            </button>
            <!-- Data Amount Filter Buttons -->
            {% for group in grouped_plans %}
            {% set filter_id = group.data_amount.lower().replace(' ', '-') %}
            <button onclick="filterPlans('{{ filter_id }}')"
                class="filter-btn px-4 py-2 text-sm font-semibold text-gray-700 bg-gray-100 hover:bg-blue-100 rounded-full transition-all duration-200 whitespace-nowrap"
                data-filter="{{ filter_id }}">
                {{ group.data_amount }}
            </button>
            {% endfor %}
        </div>
    </div>
</nav>

<!-- Comparison Sections by Data Amount -->
<section class="container mx-auto px-4 py-12">
    {% for group in grouped_plans %}
    {% set filter_id = group.data_amount.lower().replace(' ', '-') %}
    <div class="plan-section mb-12" data-filter="{{ filter_id }}">
        <!-- Section Header -->
        <div class="mb-6">
            <h2 class="text-2xl md:text-3xl font-bold text-gray-900 mb-2">{{ group.data_amount }} Plans</h2>
            <p class="text-gray-600">Compare all providers for {{ group.data_amount }}</p>
        </div>

        <!-- Plans Grid - 5 columns on xl screens -->
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 xl:grid-cols-5 gap-4">
            {% for plan in group.plans %}
            <div
                class="relative bg-white rounded-lg shadow-md hover:shadow-xl transition-all duration-300 overflow-hidden border {% if plan.is_cheapest %}border-green-500 border-2{% else %}border-gray-200{% endif %}">
                <!-- Best Price Badge - Small, Top Right -->
                {% if plan.is_cheapest %}
                <div
                    class="absolute top-2 right-2 bg-green-500 text-white text-[10px] font-bold px-2 py-0.5 rounded-full shadow-md z-20">
                    BEST PRICE
                </div>
                {% endif %}

                <div class="p-3">
                    <!-- Provider Name with Logo - Large and Bold -->
                    <div class="flex items-center gap-2 mb-2 pr-10">
                        <img src="{{ plan.logo_url }}" alt="{{ plan.name }} logo"
                            class="w-12 h-12 rounded-full bg-white p-1 border border-gray-200 object-contain flex-shrink-0">
                        <h3 class="text-lg font-bold text-gray-900">{{ plan.name }}</h3>
                    </div>

                    <!-- Star Rating Trust Signal -->
                    <div class="flex items-center gap-1 mb-3">
                        <span class="text-yellow-500 text-sm">â˜…</span>
                        <span class="text-sm font-bold text-gray-900">{{ "%.1f"|format(plan.rating) }}</span>
                        <span class="text-xs text-gray-500">({{ plan.review_count }})</span>
                    </div>

                    <!-- Price - Prominent Element -->
                    <div class="my-2">
                        <span
                            class="text-3xl font-bold {% if plan.is_cheapest %}text-green-600{% else %}text-blue-600{% endif %}">${{
                            "%.2f"|format(plan.price) }}</span>
                    </div>

                    <!-- Features List -->
                    <div class="mb-4">
                        <ul class="space-y-0.5">
                            {% for benefit in plan.benefits %}
                            <li class="text-xs text-gray-600">{{ benefit }}</li>
                            {% endfor %}
                        </ul>
                    </div>

                    <!-- Buy Now Button - High CTA -->
                    <a href="{{ plan.link }}" target="_blank" rel="noopener noreferrer"
                        class="w-full block text-center bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 rounded-lg transition-all shadow-md transform hover:-translate-y-0.5">
                        Buy Now
                    </a>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endfor %}
</section>

<!-- Filter JavaScript -->
<script>
    function filterPlans(filterValue) {
        // Get all plan sections
        const sections = document.querySelectorAll('.plan-section');
        const filterButtons = document.querySelectorAll('.filter-btn');

        // Remove active class from all buttons
        filterButtons.forEach(btn => {
            btn.classList.remove('active', 'bg-blue-600', 'text-white');
            btn.classList.add('bg-gray-100', 'text-gray-700', 'hover:bg-blue-100');
        });

        // Show/hide sections based on filter
        if (filterValue === 'all') {
            // Show all sections
            sections.forEach(section => {
                section.style.display = 'block';
            });
            // Activate "All Plans" button (first button)
            const allPlansBtn = document.querySelector('button[onclick="filterPlans(\'all\')"]');
            if (allPlansBtn) {
                allPlansBtn.classList.add('active', 'bg-blue-600', 'text-white');
                allPlansBtn.classList.remove('bg-gray-100', 'text-gray-700', 'hover:bg-blue-100');
            }
        } else {
            // Hide all sections first
            sections.forEach(section => {
                section.style.display = 'none';
            });

            // Show only matching section
            const targetSection = document.querySelector(`.plan-section[data-filter="${filterValue}"]`);
            if (targetSection) {
                targetSection.style.display = 'block';
            }

            // Activate the clicked button
            const clickedButton = document.querySelector(`button[data-filter="${filterValue}"]`);
            if (clickedButton) {
                clickedButton.classList.add('active', 'bg-blue-600', 'text-white');
                clickedButton.classList.remove('bg-gray-100', 'text-gray-700', 'hover:bg-blue-100');
            }
        }

        // No auto-scroll - keep user's current scroll position
    }

    // Initialize: show all plans by default
    document.addEventListener('DOMContentLoaded', function () {
        filterPlans('all');
    });
</script>

<style>
    /* Hide scrollbar for filter bar */
    .scrollbar-hide {
        -ms-overflow-style: none;
        scrollbar-width: none;
    }

    .scrollbar-hide::-webkit-scrollbar {
        display: none;
    }
</style>
{% endblock %}